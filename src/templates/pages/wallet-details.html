{% extends "index.html" %} {% block title %}Transactions history{% endblock %}
{% block content %} {% macro GainOrLoss(value, suffix) %} 
  {% if value > 0 %}
  <td class="gain">+{{ FormatDecimal(value) }}{{suffix}}</td>
  {% elif value < 0 %}
  <td class="loss">{{ FormatDecimal(value) }}{{suffix}}</td>
  {% else %}
  <td class="neutral">{{ FormatDecimal(value) }}{{suffix}}</span>
{% endif %} {% endmacro %}

<div id="wallet-possitions">
  <table>
    <tr>
      <th>Asset name</th>
      <th>Open positions</th>
      <th>Current price</th>
      <th>Current asset worth</th>
      <th>Total cost</th>
      <th>Gain/Loss</th>
      <th>Gain/Loss %</th>
      <th>Asset Average buy price</th>
    </tr>
    {% for position in walletPositions %}
    <tr>
      <td>{{position.assetName}}</td>
      <td>{{ position.currentAssetCount }}</td>
      <td>{{ FormatDecimal(position.lastAssetCloseValue) }} zł</td> 
      <td>{{ FormatDecimal(position.currentAssetWorth)}} zł</td>
      <td>{{ FormatDecimal(position.transactionTotalCost) }} zł</td>
      {{ GainOrLoss(position.assetGain, ' zł') }}
      {% if position.assetPercentageReturn != none %} 
        {{ GainOrLoss(position.assetPercentageReturn * 100, ' %')}}
      {% else %}
        <td></td>
      {% endif %}
      <td>{{ FormatDecimal(position.assetAverageBuyPrice)}}</td>
    </tr>
    {%endfor%}
  </table>

  <div id="transactions-add-navigation-panel">
    <a href="transaction-add"><button>Add transaction</button></a>
  </div>

  <h1>Assets pie chart:</h1>
  <div style="width: 400px; height: 400px;">
    <canvas id="pie-chart" width="100" height="100"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Sample data
  var labels = {{ pieChartLabels | tojson }} ;
  var data = {{ pieChartValues | tojson }} ;

  var ctx = document.getElementById('pie-chart').getContext('2d');
  var pieChart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: labels,
      datasets: [{
        data: data,
      }]
    },
    options: {
    }
  });
</script>
{% endblock %}
